# ‚úÖ Render Deployment Checklist

Quick checklist to deploy Carnet de Sant√© Django to Render.com

---

## üì¶ Pre-Deployment (Local)

### Files Created
- [ ] `build.sh` - Build script for Render
- [ ] `render.yaml` - Service configuration (web + database)
- [ ] `requirements.txt` - Updated with production dependencies
- [ ] `requirements_ai.txt` - ML dependencies
- [ ] `.env.example` - Environment variables template
- [ ] `projetPython/settings.py` - Updated for production

### Git Operations
- [ ] Make build.sh executable: `git update-index --chmod=+x build.sh`
- [ ] Stage deployment files: `git add build.sh render.yaml requirements*.txt .env.example projetPython/settings.py`
- [ ] Commit: `git commit -m "Add Render deployment configuration"`
- [ ] Push to GitHub: `git push origin feature/ai-recommendations-improvements`

### Verification
- [ ] All deployment files in repository
- [ ] Branch `feature/ai-recommendations-improvements` pushed to GitHub
- [ ] `models/v1/` directory with ML models committed
- [ ] No sensitive data in committed files

---

## üöÄ Render Setup

### Account & Connection
- [ ] Sign up/login at [render.com](https://render.com)
- [ ] Connect GitHub account to Render
- [ ] Authorize Render to access repositories

### Create Blueprint
- [ ] Click "New +" ‚Üí "Blueprint"
- [ ] Select repository: `Carnet-de-sant--Django`
- [ ] Select branch: `feature/ai-recommendations-improvements`
- [ ] Render detects `render.yaml`
- [ ] Click "Apply" to create services

### Services Created
- [ ] PostgreSQL Database: `carnet-sante-db` (free tier)
- [ ] Web Service: `carnet-sante-django` (free tier)
- [ ] Services auto-linked via `DATABASE_URL`

---

## üîê Environment Variables (Optional)

### Auto-Configured (Already Set)
- [x] `DATABASE_URL` - Auto-linked from PostgreSQL
- [x] `SECRET_KEY` - Auto-generated by Render
- [x] `DEBUG` - Set to `False`
- [x] `ALLOWED_HOSTS` - Set to `.onrender.com`
- [x] `PYTHON_VERSION` - Set to `3.11.0`

### Optional (Set in Web Service ‚Üí Environment)
- [ ] `DJANGO_SUPERUSER_USERNAME` = `admin` (recommended)
- [ ] `DJANGO_SUPERUSER_EMAIL` = `admin@example.com`
- [ ] `DJANGO_SUPERUSER_PASSWORD` = `YourSecurePassword123!`

---

## üèóÔ∏è Build & Deploy

### Monitor Build
- [ ] Go to Web Service ‚Üí "Logs" tab
- [ ] Watch build process (~5-10 minutes)
- [ ] Verify steps complete:
  - [ ] Python 3.11.0 installed
  - [ ] Dependencies installed (requirements.txt)
  - [ ] ML dependencies installed (requirements_ai.txt)
  - [ ] Static files collected (`121 static files copied`)
  - [ ] Migrations applied (`OK` for all apps)
  - [ ] Superuser created (if env vars set)

### Verify Deployment Success
- [ ] Build shows: `Build succeeded üéâ`
- [ ] Service shows: `Your service is live üöÄ`
- [ ] Status indicator: Green (Live)
- [ ] Live URL displayed: `https://carnet-sante-django.onrender.com`

---

## ‚úÖ Post-Deployment Testing

### 1. Basic Connectivity
- [ ] Homepage loads: `https://[your-app].onrender.com/`
- [ ] No 500 errors
- [ ] No "Application failed to respond" errors

### 2. Admin Panel
- [ ] Admin accessible: `https://[your-app].onrender.com/admin/`
- [ ] Can log in with superuser credentials
- [ ] Django admin dashboard displays correctly
- [ ] CSS/JS loads (page styled properly)

### 3. AI Recommendations Dashboard
- [ ] Dashboard loads: `https://[your-app].onrender.com/reco/dashboard/`
- [ ] Can add health metrics (form works)
- [ ] Can generate recommendations (button works)
- [ ] No database errors

### 4. Recommendations Page
- [ ] Page loads: `https://[your-app].onrender.com/reco/recommendations/`
- [ ] Shows personalized recommendations
- [ ] Confidence scores display (68-93%)
- [ ] Feedback buttons work:
  - [ ] "üëç Helpful" button clickable
  - [ ] "‚úÖ Acted Upon" button clickable
  - [ ] AJAX requests succeed (200 OK)
  - [ ] UI updates after feedback

### 5. AI Progress Page
- [ ] Page loads: `https://[your-app].onrender.com/reco/ai-progress/`
- [ ] Shows learning statistics:
  - [ ] Feedback count displays
  - [ ] Helpful rate shows percentage
  - [ ] Average confidence displays
  - [ ] Learning milestones track progress
- [ ] Data updates after giving feedback

### 6. ML Model Loading
- [ ] Check Render logs for:
  - [ ] `Loading ML model from: models/v1/model_calibrated.joblib`
  - [ ] `‚úÖ Calibrated model loaded successfully!`
  - [ ] `Model accuracy: 93.75%`
- [ ] No model loading errors
- [ ] Predictions return valid confidence scores

### 7. Static Files
- [ ] CSS loads (styling works)
- [ ] JavaScript loads (interactive features work)
- [ ] Images display
- [ ] Icons show (Font Awesome)
- [ ] Bootstrap components styled

### 8. Database Operations
- [ ] Can create new users
- [ ] Can save health metrics
- [ ] Can save recommendations
- [ ] Feedback persists (doesn't disappear)
- [ ] Confidence accumulates with feedback

---

## üêõ Common Issues & Quick Fixes

### Build Fails
- [ ] Check Render logs for error message
- [ ] Verify all dependencies in requirements.txt
- [ ] Ensure `build.sh` is executable
- [ ] Check Python version specified (3.11.0)

### Database Connection Error
- [ ] Verify `DATABASE_URL` in Web Service ‚Üí Environment
- [ ] Check database service is "Available"
- [ ] Restart web service
- [ ] Check Render status page for outages

### Static Files Not Loading
- [ ] Verify `collectstatic` ran in build logs
- [ ] Check `STATIC_ROOT` in settings.py
- [ ] Ensure `whitenoise` in MIDDLEWARE
- [ ] Clear browser cache and retry

### ML Model Not Found
- [ ] Verify `models/v1/` directory in repository
- [ ] Check files exist: `model_calibrated.joblib`, `scaler.joblib`
- [ ] Ensure not in `.gitignore`
- [ ] Re-commit and push models

### 500 Server Error
- [ ] Check Render logs for traceback
- [ ] Run: `python manage.py check --deploy` (in Render Shell)
- [ ] Verify migrations applied
- [ ] Check `SECRET_KEY` is set

### Superuser Not Created
- [ ] Set `DJANGO_SUPERUSER_*` env vars
- [ ] Redeploy
- [ ] Or manually create in Render Shell:
  ```bash
  python manage.py createsuperuser
  ```

---

## üìä Success Criteria

### Deployment Complete When:
- [x] **Build**: Succeeded without errors
- [x] **Deploy**: Service shows "Live" status
- [x] **URL**: App accessible at Render URL
- [x] **Admin**: Can log in to admin panel
- [x] **Database**: PostgreSQL connected and working
- [x] **Static**: CSS/JS/images load correctly
- [x] **ML Model**: Loaded and making predictions
- [x] **Recommendations**: Generate with confidence scores
- [x] **Feedback**: Saves and updates AI Progress
- [x] **Learning**: Confidence accumulates with feedback
- [x] **Security**: DEBUG=False, secure cookies, HTTPS

---

## üéØ Final Verification Commands

### In Render Shell (Dashboard ‚Üí Web Service ‚Üí Shell)

```bash
# 1. Check deployment configuration
python manage.py check --deploy

# 2. Show applied migrations
python manage.py showmigrations

# 3. Test database connection
python manage.py dbshell
\dt  # List tables
\q   # Quit

# 4. Verify superuser exists
python manage.py shell
from users.models import CustomUser
CustomUser.objects.filter(is_superuser=True).count()
exit()

# 5. Test ML model loading
python manage.py shell
from reco.ml_service import get_personalization_service
ml = get_personalization_service()
print(f"Model loaded: {ml.model is not None}")
exit()

# 6. Generate test recommendations
python manage.py genrecos --username [your-username]
```

---

## üìà Monitoring & Maintenance

### Daily
- [ ] Check app is responding (ping homepage)
- [ ] Monitor Render logs for errors
- [ ] Verify database backups (if on paid plan)

### Weekly
- [ ] Test key user flows (login ‚Üí metrics ‚Üí recommendations ‚Üí feedback)
- [ ] Check ML model performance (confidence trends)
- [ ] Review feedback statistics

### Monthly
- [ ] Review Render usage (free tier limits)
- [ ] Check for Django/dependency updates
- [ ] Analyze user feedback patterns
- [ ] Consider upgrading to paid plan if needed

---

## üéâ Deployment Complete!

**Your live app**: `https://carnet-sante-django.onrender.com`

### What You Have Now:
- ‚úÖ Django 5.2.7 on Python 3.11.0
- ‚úÖ PostgreSQL database (free tier)
- ‚úÖ ML recommendation system (93.75% accuracy)
- ‚úÖ Cumulative confidence learning (68% ‚Üí 93%)
- ‚úÖ Feedback persistence across regeneration
- ‚úÖ Production-ready security (HTTPS, secure cookies)
- ‚úÖ Static file serving (WhiteNoise)
- ‚úÖ Automated migrations & superuser creation

### Share Your App:
- Homepage: `https://[your-app].onrender.com/`
- Dashboard: `https://[your-app].onrender.com/reco/dashboard/`
- Recommendations: `https://[your-app].onrender.com/reco/recommendations/`
- AI Progress: `https://[your-app].onrender.com/reco/ai-progress/`

---

## üìû Need Help?

- **Render Logs**: Dashboard ‚Üí Web Service ‚Üí Logs
- **Render Shell**: Dashboard ‚Üí Web Service ‚Üí Shell
- **Render Docs**: [render.com/docs](https://render.com/docs)
- **Django Docs**: [docs.djangoproject.com](https://docs.djangoproject.com)
- **GitHub Repo**: [github.com/azizsalmii/Carnet-de-sant--Django](https://github.com/azizsalmii/Carnet-de-sant--Django)

**Congratulations on your deployment!** üöÄüéä
