{% load static %}

<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>My Recommendations - AI Health | Medic</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

  <!-- Slick Carousel -->
  <link rel="stylesheet" href="{% static 'plugins/slick/slick.css' %}">
  <link rel="stylesheet" href="{% static 'plugins/slick/slick-theme.css' %}">

  <!-- FancyBox -->
  <link rel="stylesheet" href="{% static 'plugins/fancybox/jquery.fancybox.min.css' %}">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

  <!-- Theme Styles -->
  <link rel="stylesheet" href="{% static 'css/style.css' %}">

  {# ====== minimal CSS pour les dropdowns du header (inchangés) ====== #}
  <style>
    .hx-nav { display:flex; align-items:center; gap:28px; height:64px; }
    .hx-menu { display:flex; align-items:center; gap:28px; margin:0; padding:0; list-style:none; flex:1; }
    .hx-menu > li > a { color:#fff; text-transform:uppercase; font-weight:700; text-decoration:none; }
    .hx-dd { position:relative; }
    .hx-dd-toggle { display:flex; align-items:center; gap:8px; color:#fff; text-transform:uppercase; font-weight:700; text-decoration:none; }
    .hx-caret { font-size:10px; opacity:.85; margin-left:6px; }
    .hx-dd-menu {
      position:absolute; top:100%; left:0; min-width:220px; background:#ffffff;
      border-radius:10px; padding:10px; margin-top:10px; box-shadow:0 10px 30px rgba(0,0,0,.12);
      border:1px solid rgba(0,0,0,.06); display:none; z-index:50;
    }
    .hx-dd:hover .hx-dd-menu,
    .hx-dd:focus-within .hx-dd-menu { display:block; }
    .hx-dd-item { display:flex; align-items:center; gap:10px; padding:10px 12px; border-radius:8px;
                  color:#223; text-decoration:none; white-space:nowrap; }
    .hx-dd-item i { width:18px; text-align:center; color:#39b7bd; }
    .hx-dd-item:hover { background:#f2fbfb; }
    @media (max-width: 768px) {
      .hx-nav { flex-wrap:wrap; height:auto; padding:10px 0; }
      .hx-menu { flex-wrap:wrap; gap:16px; }
      .hx-dd-menu { position:static; box-shadow:none; border:none; padding:6px 0; margin:4px 0 0; display:none; background:#39b7bd10; }
      .hx-dd:hover .hx-dd-menu { display:block; }
      .hx-dd-item { color:#fff; }
    }
  </style>

  {# ====== Styles d’amélioration pour CETTE PAGE UNIQUEMENT ====== #}
  <style>
    :root{
      --hx-primary:#39b7bd;
      --hx-primary-600:#2aa6ac;
      --hx-primary-50:#e9f7f8;
      --hx-dark:#22304a;
      --hx-muted:#6b7a90;
      --hx-card:#ffffff;
      --hx-shadow:0 10px 30px rgba(0,0,0,.08);
      --hx-r:14px;
    }

    .page-section{padding:48px 0;}

    /* Barre de titre / actions */
    .hx-toolbar{
      background:linear-gradient(135deg,var(--hx-primary),var(--hx-primary-600));
      color:#fff; border-radius:var(--hx-r); padding:18px 20px; box-shadow:var(--hx-shadow);
      display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;
      margin-bottom:22px;
    }
    .hx-toolbar h1{ margin:0; font-weight:800; letter-spacing:.2px; display:flex; gap:10px; align-items:center; }
    .hx-toolbar .btn{ border-radius:10px; font-weight:700; }
    .btn-hx-white{ background:#fff; color:var(--hx-primary); border:1px solid #fff; }
    .btn-hx-white:hover{ background:transparent; color:#fff; border-color:#fff; }
    .btn-hx-ghost{ background:transparent; color:#fff; border:1px solid rgba(255,255,255,.65); }
    .btn-hx-ghost:hover{ border-color:#fff; }

    /* Cartes KPI */
    .metric-card{background:#fff;border-radius:12px;padding:18px;box-shadow:var(--hx-shadow);display:flex;align-items:center;gap:16px}
    .metric-icon{width:48px;height:48px;border-radius:10px;display:flex;align-items:center;justify-content:center;color:#fff}
    .metric-value{font-size:28px;font-weight:800;line-height:1}
    .metric-label{font-size:12px;text-transform:uppercase;color:#6c757d;letter-spacing:.04em}

    /* Reco cards */
    .recommendation-card{background:#fff;border-radius:14px;padding:18px;margin-bottom:16px;border-left:4px solid transparent;box-shadow:var(--hx-shadow)}
    .high-priority{border-left-color:#dc3545}
    .medium-priority{border-left-color:#fd7e14}
    .low-priority{border-left-color:#0d6efd}
    .recommendation-header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:10px}
    .recommendation-category{font-weight:800;color:#0d6efd;background:#eef6ff;padding:6px 10px;border-radius:999px;font-size:12px}
    .confidence-badge{font-size:12px;background:#f5f7fb;border:1px solid #e6e9f2;padding:6px 10px;border-radius:999px}
    .recommendation-text{font-size:15px;margin:8px 0;color:var(--hx-dark)}
    .recommendation-explanation{font-size:13px;color:#51607a;background:#f8fafc;border:1px dashed #e4e8f1;padding:10px 12px;border-radius:8px}

    /* Boutons d’action reco */
    .feedback-buttons .btn{border-radius:10px;font-weight:700}
    .badge-ml{background:var(--hx-primary-50); color:var(--hx-primary-600); padding:.25rem .6rem; border-radius:999px; border:1px solid #d7eef0; font-weight:700;}

    /* Loading */
    .spinner-container{display:flex;justify-content:center;align-items:center}
    .spinner-ml{width:38px;height:38px;border:4px solid #e9ecef;border-top-color:var(--hx-primary);border-radius:50%;animation:spin 0.8s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}

    /* Alertes info bas de page */
    .alert-info-custom{
      border:1px solid #ccebed; background:#f4fbfc; color:#0b5562; border-radius:12px; box-shadow:0 6px 18px rgba(0,0,0,.05);
    }

    /* Petit effet d’apparition */
    .fade-in{ animation:fadeIn .22s ease; }
    @keyframes fadeIn{ from{opacity:0; transform:translateY(4px);} to{opacity:1; transform:translateY(0);} }

    @media (max-width:768px){
      .hx-toolbar{ padding:14px; }
    }
  </style>
</head>

<body>
<div class="page-wrapper">

  {# ================== HEADER (TOP BAR + NAV) — inchangé ================== #}
  <div style="background:#ffffff;border-bottom:1px solid #eee;">
    <div class="container" style="display:flex;align-items:center;justify-content:space-between;height:48px;">
      <div style="color:#333;font-size:14px;">
        Opening Hours: Saturday to Tuesday — 8am to 10pm
      </div>

      <div style="display:flex;align-items:center;gap:18px;">
        <div style="display:flex;gap:14px;color:#666;">
          <a href="#" style="color:#666;"><i class="fab fa-facebook-f"></i></a>
          <a href="#" style="color:#666;"><i class="fab fa-twitter"></i></a>
          <a href="#" style="color:#666;"><i class="fab fa-google-plus-g"></i></a>
          <a href="#" style="color:#666;"><i class="fab fa-instagram"></i></a>
          <a href="#" style="color:#666;"><i class="fab fa-pinterest-p"></i></a>
        </div>

        <div style="display:flex;gap:10px;">
          {% if request.user.is_authenticated %}
            <a href="{% url 'profile' %}" class="btn btn-sm" style="background:#eef7ff;border:1px solid #cfe3ff;color:#0b5ed7;padding:6px 10px;border-radius:6px;">
              <i class="fa fa-user-circle"></i> Profile
            </a>
            <a href="{% url 'logout' %}" class="btn btn-sm" style="background:#0b5ed7;border:1px solid #0b5ed7;color:#fff;padding:6px 10px;border-radius:6px;">
              <i class="fa fa-sign-out-alt"></i> Log Out
            </a>
          {% else %}
            <a href="{% url 'login' %}" class="btn btn-sm" style="background:#eef7ff;border:1px solid #cfe3ff;color:#0b5ed7;padding:6px 10px;border-radius:6px;">
              <i class="fa fa-right-to-bracket"></i> Log In
            </a>
            <a href="{% url 'signup' %}" class="btn btn-sm" style="background:#0b5ed7;border:1px solid #0b5ed7;color:#fff;padding:6px 10px;border-radius:6px;">
              <i class="fa fa-user-plus"></i> Sign Up
            </a>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <nav style="background:#39b7bd;">
    <div class="container hx-nav">
      <a href="{% url 'home' %}" style="display:flex;align-items:center;gap:10px;color:#fff;text-decoration:none;">
        <img src="{% static 'images/logo.png' %}" alt="Medic.AI" style="height:36px;">
      </a>

      <ul class="hx-menu">

        <li class="hx-dd">
          <a href="#" class="hx-dd-toggle" aria-haspopup="true" aria-expanded="false">
            <i class="fas fa-notes-medical"></i> Medical Infos <span class="hx-caret"><i class="fa fa-caret-down"></i></span>
          </a>
          <div class="hx-dd-menu" role="menu" aria-label="Medical Infos">
            <a class="hx-dd-item" href="{% url 'health_data_list' %}">
              <i class="fas fa-chart-line"></i> My Data
            </a>
            <a class="hx-dd-item" href="{% url 'report_list' %}">
              <i class="fas fa-file-medical"></i> My Reports
            </a>
            <a class="hx-dd-item" href="{% url 'journal_page' %}">
              <i class="fas fa-book"></i> Journal
            </a>
          </div>
        </li>

        <li>
          <a href="{% url 'reco:recommendations' %}" style="display:flex;align-items:center;gap:8px;">
            <i class="fa fa-lightbulb"></i> Recommendations
          </a>
        </li>
          <li><a href="{% url 'reco:recommendations' %}"><i class="fa fa-lightbulb"></i> Recommendations</a></li>
      <li><a href="{% url 'health_analysis' %}"><i class="fa fa-heartbeat"></i> Health Analysis</a></li>

      {# === Emotional Analysis (même style) === #}
      <li>
        <a href="{% url 'mental:predict_text' %}"><i class="fa fa-brain"></i> Emotional Analysis</a>
      </li>
          </a>
        </li>
      </ul>
    </div>
  </nav>
  {# ================== /HEADER ================== #}

  {# ================== CONTENU ================== #}
  <div class="container page-section">
    <div class="row justify-content-center">
      <div class="col-lg-9">

        <!-- Title -->
        <div class="hx-hero-title">
          <h1 class="display-6">
            <i class="fas fa-heartbeat text-danger me-2"></i> My Health Metrics
          </h1>
          <p class="hx-hero-sub">Track your health daily for personalized recommendations</p>
        </div>

        <!-- Form Card -->
        <div class="hx-card">
          <form method="post" id="metricsForm">
            {% csrf_token %}

            <!-- Date -->
            <div class="hx-section">
              <div class="hx-section__head"><i class="fa fa-calendar-alt"></i> Date</div>
              <div class="hx-section__body">
                <label for="date" class="form-label">Data entry day</label>
                <input
                  type="date"
                  class="form-control form-control-lg"
                  id="date"
                  name="date"
                  value="{{ today|date:'Y-m-d' }}"
                  max="{{ today|date:'Y-m-d' }}"
                  required
                >
                <div class="form-text mt-1">Select the date of your measurements</div>
              </div>
            </div>

            <!-- Activity (Steps) -->
            <div class="hx-section">
              <div class="hx-section__head"><i class="fa-solid fa-person-walking"></i> Activity</div>
              <div class="hx-section__body">
                <label for="steps" class="form-label">Number of steps</label>
                <div class="input-group input-group-lg">
                  <input
                    type="number"
                    class="form-control"
                    id="steps"
                    name="steps"
                    placeholder="Ex: 8000"
                    min="0"
                    max="50000"
                    {% if today_metrics and today_metrics.steps %}value="{{ today_metrics.steps }}"{% endif %}
                  >
                  <span class="input-group-text">steps</span>
                </div>
                <div class="form-text mt-1">Recommended goal: 8000–10000 steps/day</div>
              </div>
            </div>

            <!-- Sleep -->
            <div class="hx-section">
              <div class="hx-section__head"><i class="fa-solid fa-moon"></i> Sleep</div>
              <div class="hx-section__body">
                <label for="sleep_hours" class="form-label">Hours of sleep</label>
                <div class="input-group input-group-lg">
                  <input
                    type="number"
                    class="form-control"
                    id="sleep_hours"
                    name="sleep_hours"
                    placeholder="Ex: 7.5"
                    min="0"
                    max="24"
                    step="0.5"
                    {% if today_metrics and today_metrics.sleep_hours %}value="{{ today_metrics.sleep_hours }}"{% endif %}
                  >
                  <span class="input-group-text">hours</span>
                </div>
                <div class="form-text mt-1">Recommended: 7–9 hours for adults</div>
              </div>
            </div>

            <!-- Blood Pressure -->
            <div class="hx-section">
              <div class="hx-section__head"><i class="fa-solid fa-gauge-high"></i> Blood Pressure</div>
              <div class="hx-section__body">
                <div class="row g-3">
                  <div class="col-md-6">
                    <label for="systolic_bp" class="form-label">Systolic</label>
                    <div class="input-group input-group-lg">
                      <span class="input-group-text">SYS</span>
                      <input
                        type="number"
                        class="form-control"
                        id="systolic_bp"
                        name="systolic_bp"
                        placeholder="120"
                        min="60"
                        max="250"
                        {% if today_metrics and today_metrics.systolic_bp %}value="{{ today_metrics.systolic_bp }}"{% endif %}
                      >
                      <span class="input-group-text">mmHg</span>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <label for="diastolic_bp" class="form-label">Diastolic</label>
                    <div class="input-group input-group-lg">
                      <span class="input-group-text">DIA</span>
                      <input
                        type="number"
                        class="form-control"
                        id="diastolic_bp"
                        name="diastolic_bp"
                        placeholder="80"
                        min="40"
                        max="150"
                        {% if today_metrics and today_metrics.diastolic_bp %}value="{{ today_metrics.diastolic_bp }}"{% endif %}
                      >
                      <span class="input-group-text">mmHg</span>
                    </div>
                  </div>
                </div>
                <div class="form-text mt-1">Indicative normal value: &lt; 120/80 mmHg</div>
              </div>
            </div>

            <!-- Info -->
            <div class="alert alert-info">
              <i class="fas fa-info-circle me-2"></i>
              <strong>Tip:</strong> Enter at least 2–3 metrics to get personalized recommendations.
              You can fill in the other fields later.
            </div>

            <!-- Actions -->
            <div class="d-grid gap-2 d-md-flex justify-content-md-between mt-3">
              <a href="{% url 'reco:dashboard' %}" class="btn btn-outline-secondary btn-lg">
                <i class="fas fa-arrow-left me-2"></i> Back
              </a>
              <button type="submit" class="btn btn-primary btn-lg">
                <i class="fas fa-save me-2"></i> Save
              </button>
            </div>
          </form>
        </div>

        <!-- Quick Stats -->
        {% if today_metrics %}
        <div class="alert alert-success mt-4" style="border-radius:12px;">
          <h5 class="mb-3">
            <i class="fas fa-check-circle me-2"></i>Existing metrics for today
          </h5>
          <div class="row">
            {% if today_metrics.steps %}
            <div class="col-6 col-md-3 mb-2"><strong>Steps:</strong> {{ today_metrics.steps|floatformat:0 }}</div>
            {% endif %}
            {% if today_metrics.sleep_hours %}
            <div class="col-6 col-md-3 mb-2"><strong>Sleep:</strong> {{ today_metrics.sleep_hours }}h</div>
            {% endif %}
            {% if today_metrics.systolic_bp and today_metrics.diastolic_bp %}
            <div class="col-12 col-md-6 mb-2"><strong>Blood Pressure:</strong> {{ today_metrics.systolic_bp|floatformat:0 }}/{{ today_metrics.diastolic_bp|floatformat:0 }} mmHg</div>
            {% endif %}
          </div>
          <small class="text-muted">Edit above then click "Save" to update.</small>
        </div>
        {% endif %}

        <!-- Tips -->
        <div class="row mt-4">
          <div class="col-md-4 mb-3">
            <div class="hx-tip">
              <i class="fas fa-mobile-alt fa-3x text-primary mb-3"></i>
              <h5>Use a tracker</h5>
              <p class="small text-muted mb-0">Smartwatch, smartphone or fitness band to count your steps.</p>
            </div>
          </div>
          <div class="col-md-4 mb-3">
            <div class="hx-tip">
              <i class="fas fa-clock fa-3x text-info mb-3"></i>
              <h5>Daily routine</h5>
              <p class="small text-muted mb-0">Enter your metrics every evening before bed.</p>
            </div>
          </div>
          <div class="col-md-4 mb-3">
            <div class="hx-tip">
              <i class="fas fa-chart-line fa-3x text-success mb-3"></i>
              <h5>Track your progress</h5>
              <p class="small text-muted mb-0">View trends on the dashboard.</p>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
  {# ================== /CONTENU ================== #}

  {# ================== FOOTER (identique) ================== #}
  <footer class="footer-main">
    <div class="footer-top">
      <div class="container">
        <div class="row">
          <!-- … ton footer (colonnes, posts, etc.) … -->
        </div>
      </div>
    </div>
    <div class="footer-bottom">
      <div class="container clearfix">
        <div class="copyright-text">
          <p>&copy; Copyright 2018. All Rights Reserved by
            <a href="{% url 'home' %}">Medic</a>
          </p>
        </div>
        <ul class="footer-bottom-link">
          <li><a href="{% url 'home' %}">Home</a></li>
          <li><a href="{% url 'about' %}">About</a></li>
          <li><a href="{% url 'contact' %}">Contact</a></li>
        </ul>
      </div>
    </div>
  </footer>

  <div class="scroll-to-top scroll-to-target" data-target=".header-top">
    <span class="fas fa-angle-up"></span>
  </div>
</div>

<!-- JS -->
<script src="{% static 'plugins/jquery.js' %}"></script>
<script src="{% static 'plugins/bootstrap.min.js' %}"></script>
<script src="{% static 'plugins/bootstrap-select.min.js' %}"></script>
<script src="{% static 'plugins/slick/slick.min.js' %}"></script>
<script src="{% static 'plugins/fancybox/jquery.fancybox.min.js' %}"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY"></script>
<script src="{% static 'plugins/google-map/gmap.js' %}"></script>
<script src="{% static 'plugins/validate.js' %}"></script>
<script src="{% static 'plugins/wow.js' %}"></script>
<script src="{% static 'plugins/jquery-ui.js' %}"></script>
<script src="{% static 'plugins/timePicker.js' %}"></script>
<script src="{% static 'js/script.js' %}"></script>

<script>
/* Validation légère côté client (inchangée dans l’esprit) */
document.getElementById('metricsForm').addEventListener('submit', function(e) {
  const steps = document.getElementById('steps').value;
  const sleep = document.getElementById('sleep_hours').value;
  const systolic = document.getElementById('systolic_bp').value;
  const diastolic = document.getElementById('diastolic_bp').value;

  // At least one metric
  if (!steps && !sleep && !systolic && !diastolic) {
    e.preventDefault();
    alert('Please fill in at least one metric before saving.');
    return false;
  }
  // If only one BP value is entered
  if ((systolic && !diastolic) || (!systolic && diastolic)) {
    e.preventDefault();
    alert('Please fill in both blood pressure values (systolic AND diastolic).');
    return false;
  }
  return true;
});
</script>
</body>
</html>
