{% extends 'reco/base.html' %}

{% block title %}Progression IA - HEALTH TRACK{% endblock %}

{% block content %}
<div class="container mt-5">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow-sm" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 15px;">
                <div class="card-body p-4">
                    <h1 class="mb-2"><i class="fas fa-brain"></i> Progression de l'IA</h1>
                    <p class="mb-0 fs-5">Suivez l'apprentissage de votre assistant santé personnalisé</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Global Stats -->
    <div class="row mb-4">
        <div class="col-md-4 mb-3">
            <div class="card shadow-sm h-100">
                <div class="card-body text-center">
                    <i class="fas fa-chart-line fa-3x text-primary mb-3"></i>
                    <h2 class="mb-2">{{ avg_confidence|floatformat:0 }}%</h2>
                    <p class="text-muted mb-0">Confiance Moyenne Actuelle</p>
                    {% if avg_confidence >= 70 %}
                        <span class="badge bg-success mt-2">Excellente</span>
                    {% elif avg_confidence >= 50 %}
                        <span class="badge bg-info mt-2">Bonne</span>
                    {% elif avg_confidence >= 30 %}
                        <span class="badge bg-warning mt-2">En apprentissage</span>
                    {% else %}
                        <span class="badge bg-secondary mt-2">Débutant</span>
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card shadow-sm h-100">
                <div class="card-body text-center">
                    <i class="fas fa-comments fa-3x text-success mb-3"></i>
                    <h2 class="mb-2">{{ total_feedback }}</h2>
                    <p class="text-muted mb-0">Feedbacks Donnés</p>
                    <small class="text-muted">{{ helpful_rate|floatformat:0 }}% utiles</small>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card shadow-sm h-100">
                <div class="card-body text-center">
                    <i class="fas fa-rocket fa-3x text-warning mb-3"></i>
                    <h2 class="mb-2">+{{ boost_potential|floatformat:0 }}%</h2>
                    <p class="text-muted mb-0">Potentiel de Boost</p>
                    <small class="text-muted">Avec plus de feedback</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Confidence by Category -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-light">
                    <h5 class="mb-0"><i class="fas fa-layer-group"></i> Confiance par Catégorie</h5>
                </div>
                <div class="card-body">
                    {% for category_stat in category_stats %}
                    <div class="mb-4">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <div>
                                <strong>
                                    {% if category_stat.category == 'sleep' %}
                                        <i class="fas fa-moon text-primary"></i> Sommeil
                                    {% elif category_stat.category == 'activity' %}
                                        <i class="fas fa-running text-success"></i> Activité
                                    {% elif category_stat.category == 'nutrition' %}
                                        <i class="fas fa-utensils text-warning"></i> Nutrition
                                    {% elif category_stat.category == 'lifestyle' %}
                                        <i class="fas fa-heart text-danger"></i> Mode de vie
                                    {% endif %}
                                </strong>
                            </div>
                            <div>
                                <span class="badge bg-primary">{{ category_stat.confidence|floatformat:0 }}%</span>
                                <small class="text-muted ms-2">{{ category_stat.feedback_count }} feedbacks</small>
                            </div>
                        </div>
                        <div class="progress" style="height: 25px;">
                            <div class="progress-bar {% if category_stat.confidence >= 70 %}bg-success{% elif category_stat.confidence >= 50 %}bg-info{% elif category_stat.confidence >= 30 %}bg-warning{% else %}bg-secondary{% endif %}"
                                 role="progressbar"
                                 style="width: {{ category_stat.confidence }}%;"
                                 aria-valuenow="{{ category_stat.confidence }}"
                                 aria-valuemin="0"
                                 aria-valuemax="100">
                                {{ category_stat.confidence|floatformat:0 }}%
                            </div>
                        </div>
                        <div class="mt-2">
                            <small class="text-muted">
                                Base ML: {{ category_stat.base_confidence|floatformat:0 }}% | 
                                Boost: +{{ category_stat.boost|floatformat:0 }}% | 
                                Taux utile: {{ category_stat.helpful_rate|floatformat:0 }}%
                            </small>
                        </div>
                    </div>
                    {% empty %}
                    <p class="text-muted text-center">Aucune donnée de progression disponible. Commencez par donner du feedback sur vos recommandations !</p>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <!-- Learning Milestones -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-light">
                    <h5 class="mb-0"><i class="fas fa-trophy"></i> Jalons d'Apprentissage</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3 text-center mb-3">
                            <i class="fas fa-star {% if total_feedback >= 5 %}text-warning{% else %}text-muted{% endif %} fa-3x mb-2"></i>
                            <h6>Débutant</h6>
                            <small class="text-muted">5 feedbacks</small>
                            {% if total_feedback >= 5 %}
                                <div class="mt-2"><span class="badge bg-success">✓ Débloqué</span></div>
                            {% else %}
                                <div class="mt-2"><span class="badge bg-secondary">{{ total_feedback }}/5</span></div>
                            {% endif %}
                        </div>
                        <div class="col-md-3 text-center mb-3">
                            <i class="fas fa-medal {% if total_feedback >= 15 %}text-info{% else %}text-muted{% endif %} fa-3x mb-2"></i>
                            <h6>Intermédiaire</h6>
                            <small class="text-muted">15 feedbacks</small>
                            {% if total_feedback >= 15 %}
                                <div class="mt-2"><span class="badge bg-success">✓ Débloqué</span></div>
                            {% else %}
                                <div class="mt-2"><span class="badge bg-secondary">{{ total_feedback }}/15</span></div>
                            {% endif %}
                        </div>
                        <div class="col-md-3 text-center mb-3">
                            <i class="fas fa-award {% if total_feedback >= 30 %}text-success{% else %}text-muted{% endif %} fa-3x mb-2"></i>
                            <h6>Avancé</h6>
                            <small class="text-muted">30 feedbacks</small>
                            {% if total_feedback >= 30 %}
                                <div class="mt-2"><span class="badge bg-success">✓ Débloqué</span></div>
                            {% else %}
                                <div class="mt-2"><span class="badge bg-secondary">{{ total_feedback }}/30</span></div>
                            {% endif %}
                        </div>
                        <div class="col-md-3 text-center mb-3">
                            <i class="fas fa-crown {% if total_feedback >= 50 %}text-warning{% else %}text-muted{% endif %} fa-3x mb-2"></i>
                            <h6>Expert</h6>
                            <small class="text-muted">50 feedbacks</small>
                            {% if total_feedback >= 50 %}
                                <div class="mt-2"><span class="badge bg-success">✓ Débloqué</span></div>
                            {% else %}
                                <div class="mt-2"><span class="badge bg-secondary">{{ total_feedback }}/50</span></div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Actions -->
    <div class="row">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-body text-center p-4">
                    <h5 class="mb-3"><i class="fas fa-lightbulb"></i> Comment améliorer l'IA ?</h5>
                    <p class="text-muted mb-4">Plus vous donnez de feedback, plus les recommandations deviennent précises !</p>
                    <div class="d-flex justify-content-center gap-3 flex-wrap">
                        <a href="{% url 'add_metrics' %}" class="btn btn-primary">
                            <i class="fas fa-plus-circle"></i> Ajouter des Métriques
                        </a>
                        <a href="{% url 'recommendations_view' %}" class="btn btn-success">
                            <i class="fas fa-lightbulb"></i> Voir Recommandations
                        </a>
                        <a href="{% url 'dashboard' %}" class="btn btn-outline-secondary">
                            <i class="fas fa-chart-line"></i> Dashboard
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
